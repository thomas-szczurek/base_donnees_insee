WITH d AS (
  SELECT 
	"CODGEO",
	regexp_replace('pop_p,' || "POP_P" || ',
			pop_0_14_ans_p,' || "POP0014_P" || ',
			pop_15_29_ans_p,' || "POP1529_P" || ',
			pop_30_44_ans_p,' || "POP3044_P" || ',
			pop_45_59_ans_p,' || "POP4559_P" || ',
			pop_60_74_ans_p,' || "POP6074_P" || ',
			pop_75_89_ans_p,' || "POP7589_P" || ',
			pop_90_ans_plus_p,' || "POP90P_P" || ',
			hommes,' || "POPH_P" || ',
			hommes_0_14_ans_p,' || "H0014_P" || ',
			hommes_15_29_ans_p,' || "H1529_P" || ',
			hommes_30_44_ans_p,' || "H3044_P" || ',
			hommes_45_59_ans_p,' || "H4559_P" || ',
			hommes_60_74_ans_p,' || "H6074_P" || ',
			hommes_75_89_ans_p,' || "H7589_P" || ',	
			hommes_90_ans_plus_p,' || "H90P_P" || ',
			hommes_0_19_ans_p,' || "H0019_P" || ',
			hommes_20_64_ans_p,' || "H2064_P" || ',
			hommes_65_ans_plus_p,' || "H65P_P" || ',
			femmes,' || "POPF_P" || ',
			femmes_0_14_ans_p,' || "F0014_P" || ',
			femmes_15_29_ans_p,' || "F1529_P" || ',
			femmes_30_44_ans_p,' || "F3044_P" || ',
			femmes_45_59_ans_p,' || "F4559_P" || ',
			femmes_60_74_ans_p,' || "F6074_P" || ',
			femmes_75_89_ans_p,' || "F7589_P" || ',
			femmes_90_ans_plus_p,' || "F90P_P" || ',					
			femmes_0_19_ans_p,' || "F0019_P" || ',
			femmes_20_64_ans_p,' || "F2064_P" || ',
			femmes_65_ans_plus_p,' || "F65P_P" || ',
			pop_1an_ou_plus_localisee_1an_auparavant,' || "POP01P_P" || ',
			pop_1an_ou_plus_meme_logement_1an_auparavant,' || "POP01P_IRAN1_P" || ',
			pop_1an_ou_plus_meme_commune_1an_auparavant,' || "POP01P_IRAN2_P" || ',
			pop_1an_ou_plus_meme_departement_1an_auparavant,' || "POP01P_IRAN3_P" || ',
			pop_1an_ou_plus_meme_region_1an_auparavant,' || "POP01P_IRAN4_P" || ',
			pop_1an_ou_plus_autre_region_1an_auparavant,' || "POP01P_IRAN5_P" || ',
			pop_1an_ou_plus_un_dom_1an_auparavant,' || "POP01P_IRAN6_P" || ',
			pop_1an_ou_plus_hors_metropole_ou_dom_1an_auparavant,' || "POP01P_IRAN7_P" || ',					
			pop_1_14ans_autre_logement_1an_auparavant,' || "POP0114_IRAN2P_P" || ',
			pop_1_14ans_meme_commune_1an_auparavant,' || "POP0114_IRAN2_P" || ',					
			pop_1_14ans_autre_commune_1an_auparavant,' || "POP0114_IRAN3P_P" || ',
			pop_15_24ans_autre_logement_1an_auparavant,' || "POP1524_IRAN2P_P" || ',
			pop_15_24ans_meme_commune_1an_auparavant,' || "POP1524_IRAN2_P" || ',					
			pop_15_24ans_autre_commune_1an_auparavant,' || "POP1524_IRAN3P_P" || ',	
			pop_25_54ans_autre_logement_1an_auparavant,' || "POP2554_IRAN2P_P" || ',
			pop_25_54ans_meme_commune_1an_auparavant,' || "POP2554_IRAN2_P" || ',
			pop_25_54ans_autre_commune_1an_auparavant,' || "POP2554_IRAN3P_P" || ',
			pop_55_ou_plus_autre_logement_1an_auparavant,' || "POP55P_IRAN2P_P" || ',
			pop_55_ou_plus_meme_commune_1an_auparavant,' || "POP55P_IRAN2_P" || ',
			pop_55_ou_plus_autre_commune_1an_auparavant,' || "POP55P_IRAN3P_P" || ',
			pop_15_ans_plus_c,' || "POP15P_C" || ',
			agriculteurs_15_ans_plus_c,' || "POP15P_CS1_C" || ',
			artisants_commercants_chefs_entreprise_15_ans_plus_c,' || "POP15P_CS2_C" || ',
			cadres_prof_intel_sup_15_ans_plus_c,' || "POP15P_CS3_C" || ',
			professions_intermediaires_15_ans_plus_c,' || "POP15P_CS4_C" || ',
			employes_15_ans_plus_c,' || "POP15P_CS5_C" || ',
			ouvriers_15_ans_plus_c,' || "POP15P_CS6_C" || ',
			retraites_15_ans_plus_c,' || "POP15P_CS7_C" || ',
			autres_15_ans_plus_c,' || "POP15P_CS8_C" || ',
			hommes_15_ans_plus_c,' || "H15P_C" || ',
			h_agriculteurs_15_ans_plus_c,' || "H15P_CS1_C" || ',
			h_artisants_commercants_chefs_entreprise_15_ans_plus_c,' || "H15P_CS2_C" || ',
			h_cadres_prof_intel_sup_15_ans_plus_c,' || "H15P_CS3_C" || ',
			h_professions_intermediaires_15_ans_plus_c,' || "H15P_CS4_C" || ',
			h_employes_15_ans_plus_c,' || "H15P_CS5_C" || ',
			h_ouvriers_15_ans_plus_c,' || "H15P_CS6_C" || ',
			h_retraites_15_ans_plus_c,' || "H15P_CS7_C" || ',
			h_autres_15_ans_plus_c,' || "H15P_CS8_C" || ',
			femmes_15_ans_plus_c,' || "F15P_C" || ',
			f_agricultrices_15_ans_plus_c,' || "F15P_CS1_C" || ',
			f_artisanes_commercantes_cheffes_entreprise_15_ans_plus_c,' || "F15P_CS2_C" || ',
			f_cadres_prof_intel_sup_15_ans_plus_c,' || "F15P_CS3_C" || ',
			f_professions_intermediaires_15_ans_plus_c,' || "F15P_CS4_C" || ',
			f_employees_15_ans_plus_c,' || "F15P_CS5_C" || ',
			f_ouvrieres_15_ans_plus_c,' || "F15P_CS6_C" || ',
			f_retraitees_15_ans_plus_c,' || "F15P_CS7_C" || ',
			f_autres_15_ans_plus_c,' || "F15P_CS8_C" || ',
			population_15_24_ans_c,' || "POP1524_C" || ',
			pop_15_24_ans_agriculteurs_c,' || "POP1524_CS1_C" || ',
			pop_15_24_ans_artisants_commercants_chefs_entreprise_c,' || "POP1524_CS2_C" || ',					
			pop_15_24_ans_cadres_prof_intel_sup_c,' || "POP1524_CS3_C" || ',
			pop_15_24_ans_professions_intermediaires_c,' || "POP1524_CS4_C" || ',
			pop_15_24_ans_employes_c,' || "POP1524_CS5_C" || ',
			pop_15_24_ans_ouvriers_c,' || "POP1524_CS6_C" || ',
			pop_15_24_ans_retraites_c,' || "POP1524_CS7_C" || ',
			pop_15_24_ans_autres_c,' || "POP1524_CS8_C" || ',
			population_25_54_ans_c,' || "POP2554_C" || ',
			pop_25_54_ans_agriculteurs_c,' || "POP2554_CS1_C" || ',
			pop_25_54_ans_artisants_commercants_chefs_entreprise_c,' || "POP2554_CS2_C" || ',					
			pop_25_54_ans_cadres_prof_intel_sup_c,' || "POP2554_CS3_C" || ',
			pop_25_54_ans_professions_intermediaires_c,' || "POP2554_CS4_C" || ',
			pop_25_54_ans_employes_c,' || "POP2554_CS5_C" || ',
			pop_25_54_ans_ouvriers_c,' || "POP2554_CS6_C" || ',
			pop_25_54_ans_retraites_c,' || "POP2554_CS7_C" || ',
			pop_25_54_ans_autres_c,' || "POP2554_CS8_C" || ',
			population_55_ans_et_plus_c,' || "POP55P_C" || ',
			pop_55_ans_et_plus_ans_agriculteurs_c,' || "POP55P_CS1_C" || ',
			pop_55_ans_et_plus_ans_artisants_commercants_chefs_entreprise_c,' || "POP55P_CS2_C" || ',					
			pop_55_ans_et_plus_ans_cadres_prof_intel_sup_c,' || "POP55P_CS3_C" || ',
			pop_55_ans_et_plus_ans_professions_intermediaires_c,' || "POP55P_CS4_C" || ',
			pop_55_ans_et_plus_ans_employes_c,' || "POP55P_CS5_C" || ',
			pop_55_ans_et_plus_ans_ouvriers_c,' || "POP55P_CS6_C" || ',
			pop_55_ans_et_plus_ans_retraites_c,' || "POP55P_CS7_C" || ',
			pop_55_ans_et_plus_ans_autres_c,' || "POP55P_CS8_C" || '}',
		E'[\t\n\r]','','g') AS data
      FROM insee.import_rp_population
)
INSERT INTO insee.donnees_communes("annee","fk_base","donnees", "code_commune")
SELECT
	2020,
	1,
	jsonb_object(string_to_array(data::text,',')),
	"CODGEO" 
FROM d
ORDER BY "CODGEO"
